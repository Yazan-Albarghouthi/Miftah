{% extends 'base.html' %}

{% block title %}{{ study_set.title|default:'بطاقات تعليمية' }} - مفتاح{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="mb-1">
                        <i class="bi bi-stack me-2 text-primary"></i>
                        {{ study_set.title|default:'بطاقات تعليمية' }}
                    </h4>
                    <div class="text-muted">
                        {{ flashcards|length }} بطاقة
                        •
                        {% if study_set.language == 'ar' %}العربية{% else %}English{% endif %}
                    </div>
                </div>
                {% if is_owner %}
                <div class="d-flex gap-2">
                    <a href="{% url 'posts:create' %}?study_set={{ study_set.pk }}" class="btn btn-primary">
                        <i class="bi bi-share me-1"></i>
                        مشاركة
                    </a>
                    <a href="{% url 'study:delete' study_set.pk %}" class="btn btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Flashcard Carousel -->
            <div class="flashcard-container mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <button class="btn btn-outline-secondary" onclick="prevCard()" id="prev-btn">
                        <i class="bi bi-chevron-right"></i>
                        السابق
                    </button>
                    <span class="text-muted" id="card-counter">1 / {{ flashcards|length }}</span>
                    <button class="btn btn-outline-secondary" onclick="nextCard()" id="next-btn">
                        التالي
                        <i class="bi bi-chevron-left"></i>
                    </button>
                </div>

                {% for card in flashcards %}
                <div class="flashcard {% if not forloop.first %}d-none{% endif %}"
                     data-index="{{ forloop.counter0 }}"
                     onclick="flipCard(this)">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <div>
                                <div class="small mb-2 opacity-75">السؤال</div>
                                <div class="fs-5">{{ card.question }}</div>
                            </div>
                        </div>
                        <div class="flashcard-back">
                            <div>
                                <div class="small mb-2 opacity-75">الإجابة</div>
                                <div class="fs-5">{{ card.answer }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <div class="text-center mt-3 text-muted">
                    <i class="bi bi-hand-index-thumb"></i>
                    اضغط على البطاقة لقلبها
                </div>
            </div>

            <!-- All Cards List -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">جميع البطاقات</h6>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        {% for card in flashcards %}
                        <div class="list-group-item">
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted">السؤال</small>
                                    <p class="mb-0">{{ card.question }}</p>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-muted">الإجابة</small>
                                    <p class="mb-0">{{ card.answer }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    let currentIndex = 0;
    const totalCards = {{ flashcards|length }};

    function showCard(index) {
        document.querySelectorAll('.flashcard').forEach((card, i) => {
            card.classList.toggle('d-none', i !== index);
            card.classList.remove('flipped');
        });
        document.getElementById('card-counter').textContent = `${index + 1} / ${totalCards}`;

        // Update button states
        document.getElementById('prev-btn').disabled = index === 0;
        document.getElementById('next-btn').disabled = index === totalCards - 1;
    }

    function nextCard() {
        if (currentIndex < totalCards - 1) {
            currentIndex++;
            showCard(currentIndex);
        }
    }

    function prevCard() {
        if (currentIndex > 0) {
            currentIndex--;
            showCard(currentIndex);
        }
    }

    function flipCard(card) {
        card.classList.toggle('flipped');
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') nextCard();
        if (e.key === 'ArrowRight') prevCard();
        if (e.key === ' ') {
            e.preventDefault();
            const currentCard = document.querySelector(`.flashcard[data-index="${currentIndex}"]`);
            if (currentCard) flipCard(currentCard);
        }
    });
</script>
{% endblock %}
{% endblock %}
